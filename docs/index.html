<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactively Filter SNP Datasets • SNPfiltR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interactively Filter SNP Datasets">
<meta property="og:description" content="Is designed to interactively and reproducibly visualize and filter SNP
	(single-nucleotide polymorphism) datasets. This R-based implementation of SNP
	and genotype filters facilitates 
	an interactive and iterative SNP filtering pipeline, which can be documented
	reproducibly via Rmarkdown. SNPfiltR contains functions for visualizing 
	various quality and missing data metrics for a SNP dataset, and then filtering
	the dataset based on user specified cutoffs.
	All functions take vcfR objects as input, which can easily be
	generated by reading standard vcf (variant call format) files into R using 
	the R package vcfR (Knaus and Grünwald) (&lt;doi:10.1111/1755-0998.12549&gt;). 
	Each SNPfiltR function can return a newly filtered vcfR object, which can then be
	written to a local directory in standard vcf format using the vcfR package,
	for downstream population genetic and phylogenetic analyses.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">SNPfiltR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/accuracy-benchmarking.html">accuracy-benchmarking</a>
    </li>
    <li>
      <a href="articles/performance-benchmarking.html">Performance benchmarking</a>
    </li>
    <li>
      <a href="articles/reproducible-vignette.html">reproducible-vignette</a>
    </li>
    <li>
      <a href="articles/scrub-jay-RADseq-vignette.html">scrub-jay-RADseq-vignette</a>
    </li>
    <li>
      <a href="articles/scrub-jay-UCE-vignette.html">scrub-jay-UCE-vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="snpfiltr-">SNPfiltR <img src="reference/figures/logo.png" align="right" alt="" width="180"><a class="anchor" aria-label="anchor" href="#snpfiltr-"></a>
</h1></div>
<!-- badges: start -->

<p>SNPfiltR is an R package to streamline and automate the process of choosing appropriate filtering parameters for next-gen SNP datasets. The package was designed with RADseq (Restriction-site Associated DNA sequencing) data in mind, but can be used on any SNP dataset in need of data exploration and quality filtering (e.g., whole genome resequencing, UCEs, sequence capture, GBS). SNPfiltR shines when used on moderate sized reduced-representation genomic datasets, where an array of quality and completeness parameters can be rapidly explored in a single, interactive Rstudio session. SNPfiltR is available from both <a href="https://CRAN.R-project.org/package=SNPfiltR" class="external-link">CRAN</a> and <a href="https://github.com/DevonDeRaad/SNPfiltR" class="external-link">GitHub</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Install current release from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"SNPfiltR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Install current development version directly from GitHub</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"DevonDeRaad/SNPfiltR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>If you are using SNPfiltR to investigate and filter your SNP dataset, I recommend citing both SNPfiltR and the R package vcfR (which is used to read in vcf files as ‘vcfR’ objects, and heavily used inside of SNPfiltR functions) e.g., “We used the R packages <em>SNPfiltR</em> (DeRaad, 2022) and <em>vcfR</em> (Knaus and Grunwald, 2017) to iteratively filter our SNP dataset based on various quality and completeness metrics.”</p>
<p>DeRaad, D.A. (2022), SNPfiltR: an R package for interactive and reproducible SNP filtering. Molecular Ecology Resources, 22, 2443–2453, 1–15. <a href="https://doi.org/10.1111/1755-0998.13618" class="external-link uri">https://doi.org/10.1111/1755-0998.13618</a>.</p>
<p>Knaus, Brian J., and Niklaus J. Grunwald. 2017. VCFR: a package to manipulate and visualize variant call format data in R. Molecular Ecology Resources 17(1):44-53. <a href="https://doi.org/10.1111/1755-0998.12549" class="external-link uri">https://doi.org/10.1111/1755-0998.12549</a>.</p>
</div>
<div class="section level2">
<h2 id="full-documentation">Full documentation<a class="anchor" aria-label="anchor" href="#full-documentation"></a>
</h2>
<p>To see vignettes using SNPfiltR to execute an interactive SNP filtering pipeline for real empirical <a href="https://devonderaad.github.io/SNPfiltR/articles/scrub-jay-UCE-vignette.html" class="external-link">UCE data</a> and <a href="https://devonderaad.github.io/SNPfiltR/articles/scrub-jay-RADseq-vignette.html" class="external-link">RADseq data</a>, please check out the <a href="https://devonderaad.github.io/SNPfiltR/" class="external-link">pkgdown site</a>. Or, for a quick start, simply follow the example pipeline executed below:</p>
<div class="section level3">
<h3 id="optional-step-0">Optional Step 0:<a class="anchor" aria-label="anchor" href="#optional-step-0"></a>
</h3>
<p>Do quality control per sample before performing SNP calling. I have written an <a href="https://github.com/DevonDeRaad/SNPfiltR/blob/master/inst/extdata/fastqcr.Rmd" class="external-link">RMarkdown script</a> which is distributed with this package, and uses the R package <a href="https://github.com/kassambara/fastqcr" class="external-link">fastqcr</a> to generate a report visualizing the quality and quantity of sequencing for each sample, and recommending a subset of samples to be immediately dropped before parameter optimization (specifically useful for RADseq data). The only modification necessary for this script is the path to the folder containing the input .fastq.gz files and the path to your desired output folder. An example report generated using this script can be seen <a href="https://devonderaad.github.io/RADstackshelpR/articles/quality.control.vignette.html" class="external-link">here</a>. Because the fastq.gz files for your experiment may be large and handled remotely, an example bash script for executing this RMarkdown file as a job on a high performance computing cluster is also included <a href="https://github.com/DevonDeRaad/SNPfiltR/blob/master/inst/extdata/RMarkdown.qc.submit.script.sh" class="external-link">here</a>.</p>
<div class="section level4">
<h4 id="because-this-dataset-was-not-overly-large-and-i-used-a-reference-based-assembly-that-doesnt-depend-on-each-sample-contributing-to-the-de-novo-building-of-rad-loci-i-chose-to-skip-this-step-and-do-all-of-the-per-sample-quality-filtering-in-r-i-started-below-by-reading-in-the-vcf-file-using-the-aforementioned-vcfr-package-this-example-uses-a-subset-proportion-of-a-real-vcf-file-in-order-to-control-runtimes-the-full-analysis-of-this-dataset-can-be-viewed-here">Because this dataset was not overly large, and I used a reference based assembly that doesn’t depend on each sample contributing to the de novo building of RAD loci, I chose to skip this step and do all of the per sample quality filtering in R. I started below by reading in the vcf file using the aforementioned vcfR package. This example uses a subset proportion of a real vcf file in order to control runtimes. The full analysis of this dataset can be viewed <a href="https://devonderaad.github.io/SNPfiltR/articles/scrub-jay-RADseq-vignette.html" class="external-link">here</a>
<a class="anchor" aria-label="anchor" href="#because-this-dataset-was-not-overly-large-and-i-used-a-reference-based-assembly-that-doesnt-depend-on-each-sample-contributing-to-the-de-novo-building-of-rad-loci-i-chose-to-skip-this-step-and-do-all-of-the-per-sample-quality-filtering-in-r-i-started-below-by-reading-in-the-vcf-file-using-the-aforementioned-vcfr-package-this-example-uses-a-subset-proportion-of-a-real-vcf-file-in-order-to-control-runtimes-the-full-analysis-of-this-dataset-can-be-viewed-here"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="step-1">Step 1:<a class="anchor" aria-label="anchor" href="#step-1"></a>
</h3>
<div class="section level4">
<h4 id="read-in-vcf-file-using-vcfr">Read in vcf file using <a href="https://knausb.github.io/vcfR_documentation/" class="external-link">vcfR</a>
<a class="anchor" aria-label="anchor" href="#read-in-vcf-file-using-vcfr"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SNPfiltR</span><span class="op">)</span></span>
<span><span class="co">#&gt; This is SNPfiltR v.1.0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Detailed usage information is available at: devonderaad.github.io/SNPfiltR/ </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; If you use SNPfiltR in your published work, please cite the following papers: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; DeRaad, D.A. (2022), SNPfiltR: an R package for interactive and reproducible SNP filtering. Molecular Ecology Resources, 00, 1-15. http://doi.org/10.1111/1755-0998.13618 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Knaus, Brian J., and Niklaus J. Grunwald. 2017. VCFR: a package to manipulate and visualize variant call format data in R. Molecular Ecology Resources, 17.1:44-53. http://doi.org/10.1111/1755-0998.12549</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/knausb/vcfR" class="external-link">vcfR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    *****       ***   vcfR   ***       *****</span></span>
<span><span class="co">#&gt;    This is vcfR 1.12.0 </span></span>
<span><span class="co">#&gt;      browseVignettes('vcfR') # Documentation</span></span>
<span><span class="co">#&gt;      citation('vcfR') # Citation</span></span>
<span><span class="co">#&gt;    *****       *****      *****       *****</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##If you want to follow along, run this bash code in a terminal window to download the input file used for this tutorial directly from GitHub into the 'Downloads' folder of your local machine</span></span>
<span><span class="co">#cd Downloads/</span></span>
<span><span class="co">#wget https://github.com/DevonDeRaad/SNPfiltR.benchmarking.data/blob/main/subset.scrub.vcf.gz?raw=true</span></span>
<span><span class="co">#gunzip subset.scrub.vcf.gz</span></span>
<span></span>
<span><span class="co">#read vcf into this R session as vcfR </span></span>
<span><span class="va">vcfR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/io_vcfR.html" class="external-link">read.vcfR</a></span><span class="op">(</span><span class="st">"~/Downloads/subset.scrub.vcf"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### check the metadata present in your vcf</span></span>
<span><span class="va">vcfR</span></span>
<span><span class="co">#&gt; ***** Object of Class vcfR *****</span></span>
<span><span class="co">#&gt; 20 samples</span></span>
<span><span class="co">#&gt; 71 CHROMs</span></span>
<span><span class="co">#&gt; 75,873 variants</span></span>
<span><span class="co">#&gt; Object size: 95.7 Mb</span></span>
<span><span class="co">#&gt; 34.55 percent missing data</span></span>
<span><span class="co">#&gt; *****        *****         *****</span></span>
<span></span>
<span><span class="co">#generate popmap file. Two column popmap with the same format as stacks, and the columns must be named 'id' and 'pop'</span></span>
<span><span class="va">popmap</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,pop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">3</span>,<span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-2">Step 2:<a class="anchor" aria-label="anchor" href="#step-2"></a>
</h3>
<div class="section level4">
<h4 id="implement-quality-filters-that-dont-involve-missing-data-this-is-because-removing-low-data-samples-will-alter-percentagequantile-based-missing-data-cutoffs-so-we-wait-to-implement-those-until-after-deciding-on-our-final-set-of-samples-for-downstream-analysis">Implement quality filters that don’t involve missing data. This is because removing low data samples will alter percentage/quantile based missing data cutoffs, so we wait to implement those until after deciding on our final set of samples for downstream analysis<a class="anchor" aria-label="anchor" href="#implement-quality-filters-that-dont-involve-missing-data-this-is-because-removing-low-data-samples-will-alter-percentagequantile-based-missing-data-cutoffs-so-we-wait-to-implement-those-until-after-deciding-on-our-final-set-of-samples-for-downstream-analysis"></a>
</h4>
</div>
<div class="section level4">
<h4 id="note">Note:<a class="anchor" aria-label="anchor" href="#note"></a>
</h4>
<p>I like to start with a completely unfiltered vcf file, in order to implement a cohesive, fully documentable filtering pipeline in R. However, if I have a very large unfiltered vcf file that I would like to work with in Rstudio, I sometimes perform hard filtering, or implement some conservative percentage based filters (e.g., remove all SNPs above 90% missing data) via command-line calls to the program VCFtools, in order to reduce the size of the starting vcf that I need to read into Rstudio. Just be aware that once you drop low data samples, your previously enforced (per SNP or locus) missing data % will no longer be accurate. VCFtools has faster implementations of some of the same filters implemented here, and really shines with large datasets. The R-based implementations of these filters in SNPfiltR offers interactive visualization in a cohesive R-based pipeline, but be aware that reading in excessively large files to Rstudio (typically, &gt; 1 Gb in my experience) can cause R to hang and crash. Luckily, I have found that variant sites only vcf files for most reduced-representation genomic datasets are under this size, and can be handled efficiently using Rstudio on a personal computer.</p>
</div>
<div class="section level4">
<h4 id="note-1">Note:<a class="anchor" aria-label="anchor" href="#note-1"></a>
</h4>
<p>Jon Puritz has an excellent filtering tutorial that is focused specifically on <a href="https://www.ddocent.com/filtering/" class="external-link">filtering RADseq data</a> Multiple functions in SNPfiltR were generated in order to follow the guidelines and suggestions laid out in this tutorial. We can follow these guidelines for hard filtering (he suggests minimum depth=3, gq =30), and can implement suggested filters like allele balance and max depth, here in R using SNPfiltR.</p>
</div>
<div class="section level4">
<h4 id="start-by-visualizing-the-distributions-of-depth-of-sequencing-and-genotype-quality-among-called-genotypes-then-set-appropriate-cutoffs-for-both-values-for-this-dataset">start by visualizing the distributions of depth of sequencing and genotype quality among called genotypes, then set appropriate cutoffs for both values for this dataset.<a class="anchor" aria-label="anchor" href="#start-by-visualizing-the-distributions-of-depth-of-sequencing-and-genotype-quality-among-called-genotypes-then-set-appropriate-cutoffs-for-both-values-for-this-dataset"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#visualize distributions</span></span>
<span><span class="fu"><a href="reference/hard_filter.html">hard_filter</a></span><span class="op">(</span>vcfR<span class="op">=</span><span class="va">vcfR</span><span class="op">)</span></span>
<span><span class="co">#&gt; no depth cutoff provided, exploratory visualization will be generated.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; no genotype quality cutoff provided, exploratory visualization will be generated.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-2.png" width="100%"><img src="reference/figures/README-unnamed-chunk-5-3.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ***** Object of Class vcfR *****</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 20 samples</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 71 CHROMs</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 75,873 variants</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Object size: 95.7 Mb</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 34.55 percent missing data</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; *****        *****         *****</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#hard filter to minimum depth of 5, and minimum genotype quality of 30</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>vcfR<span class="ot">&lt;-</span><span class="fu">hard_filter</span>(<span class="at">vcfR=</span>vcfR, <span class="at">depth =</span> <span class="dv">5</span>, <span class="at">gq =</span> <span class="dv">30</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 27.3% of genotypes fall below a read depth of 5 and were converted to NA</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3.5% of genotypes fall below a genotype quality of 30 and were converted to NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="then-use-this-function-to-filter-for-allele-balance">Then use this function to filter for allele balance<a class="anchor" aria-label="anchor" href="#then-use-this-function-to-filter-for-allele-balance"></a>
</h4>
<p>From the <a href="https://www.ddocent.com/filtering/" class="external-link">Ddocent SNP filtering tutorial</a> “Allele balance: a number between 0 and 1 representing the ratio of reads showing the reference allele to all reads, considering only reads from individuals called as heterozygous, we expect that the allele balance in our data (for real loci) should be close to 0.5”</p>
</div>
<div class="section level4">
<h4 id="the-snpfiltr-allele-balance-function-will-convert-heterozygous-genotypes-to-missing-if-they-fall-outside-of-the-25-75-range">the SNPfiltR allele balance function will convert heterozygous genotypes to missing if they fall outside of the .25-.75 range.<a class="anchor" aria-label="anchor" href="#the-snpfiltr-allele-balance-function-will-convert-heterozygous-genotypes-to-missing-if-they-fall-outside-of-the-25-75-range"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#execute allele balance filter</span></span>
<span><span class="va">vcfR</span><span class="op">&lt;-</span><span class="fu"><a href="reference/filter_allele_balance.html">filter_allele_balance</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">)</span></span>
<span><span class="co">#&gt; 7.66% of het genotypes (0.66% of all genotypes) fall outside of 0.25 - 0.75 allele balance ratio and were converted to NA</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p>Now we can execute a max depth filter (super high depth loci are likely multiple loci stuck together into a single paralogous locus).</p>
</div>
<div class="section level4">
<h4 id="note-2">Note:<a class="anchor" aria-label="anchor" href="#note-2"></a>
</h4>
<p>This filter is applied ‘per SNP’ rather than ‘per genotype’ otherwise we would simply be removing most of the genotypes from our deepest sequenced samples (because sequencing depth is so variable between samples). By filtering per SNP, we remove the SNPs with outlier depth values, which are most likely to be spuriously mapped/built paralagous loci.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#visualize and pick appropriate max depth cutoff</span></span>
<span><span class="fu"><a href="reference/max_depth.html">max_depth</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">)</span></span>
<span><span class="co">#&gt; cutoff is not specified, exploratory visualization will be generated.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dashed line indicates a mean depth across all SNPs of 68.3</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-2.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#filter vcf by the max depth cutoff you chose</span></span>
<span><span class="va">vcfR</span><span class="op">&lt;-</span><span class="fu"><a href="reference/max_depth.html">max_depth</a></span><span class="op">(</span><span class="va">vcfR</span>, maxdepth <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; maxdepth cutoff is specified, filtered vcfR object will be returned</span></span>
<span><span class="co">#&gt; 19.33% of SNPs were above a mean depth of 100 and were removed from the vcf</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-3.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="note-3">Note:<a class="anchor" aria-label="anchor" href="#note-3"></a>
</h4>
<p>It may be a good idea to additionally filter out SNPs that are significantly out of HWE if you have a really good idea of what the population structure in your sample looks like and good sample sizes in each pop. For this dataset, which is highly structured (many isolated island pops) with species boundaries that are in flux, I am not going to use a HWE filter, because I don’t feel comfortable confidently identifying populations in which we can expect HWE. Many other programs (such as VCFtools) can filter according to HWE if desired.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#check vcfR to see how many SNPs we have left</span></span>
<span><span class="va">vcfR</span></span>
<span><span class="co">#&gt; ***** Object of Class vcfR *****</span></span>
<span><span class="co">#&gt; 20 samples</span></span>
<span><span class="co">#&gt; 62 CHROMs</span></span>
<span><span class="co">#&gt; 61,203 variants</span></span>
<span><span class="co">#&gt; Object size: 52.4 Mb</span></span>
<span><span class="co">#&gt; 65.45 percent missing data</span></span>
<span><span class="co">#&gt; *****        *****         *****</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-3">Step 3:<a class="anchor" aria-label="anchor" href="#step-3"></a>
</h3>
<div class="section level4">
<h4 id="set-arbitrary-cutoff-for-missing-data-allowed-per-sample">Set arbitrary cutoff for missing data allowed per sample.<a class="anchor" aria-label="anchor" href="#set-arbitrary-cutoff-for-missing-data-allowed-per-sample"></a>
</h4>
<p>Determining which samples and SNPs to retain is always project specific, and is contingent on sampling, biology of the focal taxa, sequencing idiosyncrasies, etc. SNPfiltR contains functions designed to simply and easily generate exploratory visualizations that will allow you to make informed decisions about which samples and SNPs are of sufficient quality to retain for downstream analyses, but there is never a single correct option for these cutoffs. In my experience, the best thing to do is to look at your data, look at what effects some reasonable cutoffs would have on your data, and pick one that works for you. Then as you continue to analyze your data, make sure that your arbitrary filtering decisions are not driving the patterns you see, and iteratively update your filtering approach if you are concerned about the effects previous filtering choices are having on downstream results.</p>
</div>
<div class="section level4">
<h4 id="we-will-start-by-determining-which-samples-contain-too-few-sequences-to-be-used-in-downstream-analyses-by-visualizing-missing-data-per-sample">We will start by determining which samples contain too few sequences to be used in downstream analyses, by visualizing missing data per sample<a class="anchor" aria-label="anchor" href="#we-will-start-by-determining-which-samples-contain-too-few-sequences-to-be-used-in-downstream-analyses-by-visualizing-missing-data-per-sample"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#run function to visualize samples</span></span>
<span><span class="fu"><a href="reference/missing_by_sample.html">missing_by_sample</a></span><span class="op">(</span>vcfR<span class="op">=</span><span class="va">vcfR</span>, popmap <span class="op">=</span> <span class="va">popmap</span><span class="op">)</span></span>
<span><span class="co">#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with `binwidth`.</span></span>
<span><span class="co">#&gt; Bin width defaults to 1/30 of the range of the data. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"><img src="reference/figures/README-unnamed-chunk-9-2.png" width="100%"><img src="reference/figures/README-unnamed-chunk-9-3.png" width="100%"> #### Now we can try setting a reasonable threshold, and then visualizing clustering patterns to determine whether there are still problematic samples with excess missing data that can’t be accurately assigned to genetic clusters</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#run function to drop samples above the threshold we want from the vcf</span></span>
<span><span class="va">vcfR</span><span class="op">&lt;-</span><span class="fu"><a href="reference/missing_by_sample.html">missing_by_sample</a></span><span class="op">(</span>vcfR<span class="op">=</span><span class="va">vcfR</span>, cutoff <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 samples are above a 0.9 missing data cutoff, and were removed from VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="100%"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#subset popmap to only include retained individuals</span></span>
<span><span class="va">popmap</span><span class="op">&lt;-</span><span class="va">popmap</span><span class="op">[</span><span class="va">popmap</span><span class="op">$</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">@</span><span class="va">gt</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co">#remove invariant sites generated by dropping individuals</span></span>
<span><span class="va">vcfR</span><span class="op">&lt;-</span><span class="fu"><a href="reference/min_mac.html">min_mac</a></span><span class="op">(</span><span class="va">vcfR</span>, min.mac <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; 50.23% of SNPs fell below a minor allele count of 1 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-2.png" width="100%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#verify that missing data is not driving clustering patterns among the retained samples</span></span>
<span><span class="va">miss</span><span class="op">&lt;-</span><span class="fu"><a href="reference/assess_missing_data_pca.html">assess_missing_data_pca</a></span><span class="op">(</span>vcfR<span class="op">=</span><span class="va">vcfR</span>, popmap <span class="op">=</span> <span class="va">popmap</span>, thresholds <span class="op">=</span> <span class="fl">.8</span>, clustering <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; cutoff is specified, filtered vcfR object will be returned</span></span>
<span><span class="co">#&gt; 69.26% of SNPs fell below a completeness cutoff of 0.8 and were removed from the VCF</span></span>
<span><span class="co">#&gt; Loading required namespace: adegenet</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-3.png" width="100%"><img src="reference/figures/README-unnamed-chunk-10-4.png" width="100%"><img src="reference/figures/README-unnamed-chunk-10-5.png" width="100%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#if there are still problematic samples, drop them using the following syntax</span></span>
<span><span class="co">#vcfR &lt;- vcfR[,colnames(vcfR@gt) != "A_woodhouseii_24711" &amp; colnames(vcfR@gt) != "A_californica_45901"]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-4">Step 4:<a class="anchor" aria-label="anchor" href="#step-4"></a>
</h3>
<div class="section level4">
<h4 id="set-arbitrary-cutoff-for-missing-data-allowed-per-snp">Set arbitrary cutoff for missing data allowed per SNP.<a class="anchor" aria-label="anchor" href="#set-arbitrary-cutoff-for-missing-data-allowed-per-snp"></a>
</h4>
</div>
<div class="section level4">
<h4 id="we-can-visualize-the-effect-that-typical-missing-data-cutoffs-will-have-on-both-the-number-of-snps-retained-and-the-total-missing-data-in-our-entire-datasetwe-want-to-choose-a-cutoff-that-minimizes-the-overall-missing-data-in-the-dataset-while-maximizing-the-total-number-of-loci-retained">We can visualize the effect that typical missing data cutoffs will have on both the number of SNPs retained and the total missing data in our entire dataset.We want to choose a cutoff that minimizes the overall missing data in the dataset, while maximizing the total number of loci retained.<a class="anchor" aria-label="anchor" href="#we-can-visualize-the-effect-that-typical-missing-data-cutoffs-will-have-on-both-the-number-of-snps-retained-and-the-total-missing-data-in-our-entire-datasetwe-want-to-choose-a-cutoff-that-minimizes-the-overall-missing-data-in-the-dataset-while-maximizing-the-total-number-of-loci-retained"></a>
</h4>
</div>
<div class="section level4">
<h4 id="note-4">Note:<a class="anchor" aria-label="anchor" href="#note-4"></a>
</h4>
<p>This filter interacts with the above filter, where we dropped low data samples. A good rule of thumb is that individual samples shouldn’t be above 50% missing data after applying a per-SNP missing data cutoff. So if we are retaining specific low data samples out of necessity or project design, we may have to set a more stringent per-SNP missing data cutoff, at the expense of the total number of SNPs retained for downstream analyses. We can again use the assess_missing_data_pca() function to determine whether all retained samples contain enough data at our chosen cutoff in order to be assigned accurately to their species group.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#visualize missing data by SNP and the effect of various cutoffs on the missingness of each sample</span></span>
<span><span class="fu"><a href="reference/missing_by_snp.html">missing_by_snp</a></span><span class="op">(</span><span class="va">vcfR</span><span class="op">)</span></span>
<span><span class="co">#&gt; cutoff is not specified, exploratory visualizations will be generated</span></span>
<span><span class="co">#&gt; Picking joint bandwidth of 0.128</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"><img src="reference/figures/README-unnamed-chunk-11-2.png" width="100%"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    filt missingness snps.retained</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  0.30  0.28966424         23891</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  0.50  0.20181035         18653</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  0.60  0.15670806         15745</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  0.65  0.13397028         14218</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  0.70  0.11164312         12663</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  0.75  0.08957320         11053</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  0.80  0.06774145          9363</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  0.85  0.04616671          7555</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9  0.90  0.02381958          5482</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 0.95  0.00000000          3001</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 1.00  0.00000000          3001</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#verify that missing data is not driving clustering patterns among the retained samples at some reasonable thresholds</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>miss<span class="ot">&lt;-</span><span class="fu">assess_missing_data_pca</span>(<span class="at">vcfR=</span>vcfR, <span class="at">popmap =</span> popmap, <span class="at">thresholds =</span> <span class="fu">c</span>(.<span class="dv">7</span>,.<span class="dv">8</span>,.<span class="dv">85</span>), <span class="at">clustering =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cutoff is specified, filtered vcfR object will be returned</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 58.43% of SNPs fell below a completeness cutoff of 0.7 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-3.png" width="100%"><img src="reference/figures/README-unnamed-chunk-11-4.png" width="100%"></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cutoff is specified, filtered vcfR object will be returned</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-5.png" width="100%"></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 69.26% of SNPs fell below a completeness cutoff of 0.8 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-6.png" width="100%"><img src="reference/figures/README-unnamed-chunk-11-7.png" width="100%"></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cutoff is specified, filtered vcfR object will be returned</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-8.png" width="100%"></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 75.2% of SNPs fell below a completeness cutoff of 0.85 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-9.png" width="100%"><img src="reference/figures/README-unnamed-chunk-11-10.png" width="100%"><img src="reference/figures/README-unnamed-chunk-11-11.png" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#choose a value that retains an acceptable amount of missing data in each sample, and maximizes SNPs retained while minimizing overall missing data, and filter vcf</span></span>
<span><span class="va">vcfR</span><span class="op">&lt;-</span><span class="fu"><a href="reference/missing_by_snp.html">missing_by_snp</a></span><span class="op">(</span><span class="va">vcfR</span>, cutoff <span class="op">=</span> <span class="fl">.85</span><span class="op">)</span></span>
<span><span class="co">#&gt; cutoff is specified, filtered vcfR object will be returned</span></span>
<span><span class="co">#&gt; 75.2% of SNPs fell below a completeness cutoff of 0.85 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-12.png" width="100%"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#check how many SNPs and samples are left</span></span>
<span><span class="va">vcfR</span></span>
<span><span class="co">#&gt; ***** Object of Class vcfR *****</span></span>
<span><span class="co">#&gt; 19 samples</span></span>
<span><span class="co">#&gt; 34 CHROMs</span></span>
<span><span class="co">#&gt; 7,555 variants</span></span>
<span><span class="co">#&gt; Object size: 14.3 Mb</span></span>
<span><span class="co">#&gt; 4.617 percent missing data</span></span>
<span><span class="co">#&gt; *****        *****         *****</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-5">Step 5:<a class="anchor" aria-label="anchor" href="#step-5"></a>
</h3>
<div class="section level4">
<h4 id="investigate-the-effect-of-a-minor-allele-count-mac-cutoff-on-downstream-inferences">investigate the effect of a minor allele count (MAC) cutoff on downstream inferences.<a class="anchor" aria-label="anchor" href="#investigate-the-effect-of-a-minor-allele-count-mac-cutoff-on-downstream-inferences"></a>
</h4>
</div>
<div class="section level4">
<h4 id="macmaf-cutoffs-can-be-helpful-in-removing-spurious-and-uninformative-loci-from-the-dataset-but-also-have-the-potential-to-bias-downstream-inferences-linck-and-battey-2019-have-an-excellent-paper-on-just-this-topic-from-the-paper-">MAC/MAF cutoffs can be helpful in removing spurious and uninformative loci from the dataset, but also have the potential to bias downstream inferences. Linck and Battey (2019) have an excellent paper on just this topic. From the paper-<a class="anchor" aria-label="anchor" href="#macmaf-cutoffs-can-be-helpful-in-removing-spurious-and-uninformative-loci-from-the-dataset-but-also-have-the-potential-to-bias-downstream-inferences-linck-and-battey-2019-have-an-excellent-paper-on-just-this-topic-from-the-paper-"></a>
</h4>
<p>“We recommend researchers using model‐based programs to describe population structure observe the following best practices: (a) duplicate analyses with nonparametric methods suchas PCA and DAPC with cross validation (b) exclude singletons (c) compare alignments with multiple assembly parameters When seeking to exclude only singletons in alignments with missing data (a ubiquitous problem for reduced‐representation library preparation methods), it is preferable to filter by the count (rather than frequency) of the minor allele, because variation in the amount of missing data across an alignment will cause a static frequency cutoff to remove different SFS classes at different sites””</p>
</div>
<div class="section level4">
<h4 id="our-package-contains-a-convenient-wrapper-functions-that-can-filter-based-on-minor-allele-count-mac-and-streamline-investigation-of-the-effects-of-various-filtering-parameters-on-sample-clustering-patterns">Our package contains a convenient wrapper functions that can filter based on minor allele count (MAC) and streamline investigation of the effects of various filtering parameters on sample clustering patterns.<a class="anchor" aria-label="anchor" href="#our-package-contains-a-convenient-wrapper-functions-that-can-filter-based-on-minor-allele-count-mac-and-streamline-investigation-of-the-effects-of-various-filtering-parameters-on-sample-clustering-patterns"></a>
</h4>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#investigate clustering patterns with and without a minor allele cutoff</span></span>
<span><span class="co">#use min.mac() to investigate the effect of multiple cutoffs</span></span>
<span><span class="va">vcfR.mac</span><span class="op">&lt;-</span><span class="fu"><a href="reference/min_mac.html">min_mac</a></span><span class="op">(</span>vcfR <span class="op">=</span> <span class="va">vcfR</span>, min.mac <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; 39.21% of SNPs fell below a minor allele count of 2 and were removed from the VCF</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#assess clustering without MAC cutoff</span></span>
<span><span class="va">miss</span><span class="op">&lt;-</span><span class="fu"><a href="reference/assess_missing_data_tsne.html">assess_missing_data_tsne</a></span><span class="op">(</span><span class="va">vcfR</span>, <span class="va">popmap</span>, clustering <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-2.png" width="100%"><img src="reference/figures/README-unnamed-chunk-12-3.png" width="100%"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#assess clustering with MAC cutoff</span></span>
<span><span class="va">miss</span><span class="op">&lt;-</span><span class="fu"><a href="reference/assess_missing_data_tsne.html">assess_missing_data_tsne</a></span><span class="op">(</span><span class="va">vcfR.mac</span>, <span class="va">popmap</span>, clustering <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-4.png" width="100%"><img src="reference/figures/README-unnamed-chunk-12-5.png" width="100%"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#based on these visualizations, singletons are not obviously biasing clustering patterns, so I will leave them in for now. If I want to run a program like STRUCTURE, where singletons are known to bias inference, I can write out the vcf with singletons removed as well:</span></span>
<span><span class="co">#vcfR::write.vcf(vcfR.mac, file = "~/Downloads/scrub.jay.mac.vcf.gz")</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="finally-we-will-make-sure-that-the-depth-and-genotype-quality-look-consistent-across-snps-and-samples-following-our-filtering-pipeline">Finally, we will make sure that the depth and genotype quality look consistent across SNPs and samples, following our filtering pipeline.<a class="anchor" aria-label="anchor" href="#finally-we-will-make-sure-that-the-depth-and-genotype-quality-look-consistent-across-snps-and-samples-following-our-filtering-pipeline"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot depth per snp and per sample</span></span>
<span><span class="va">dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/extract_gt.html" class="external-link">extract.gt</a></span><span class="op">(</span><span class="va">vcfR</span>, element <span class="op">=</span> <span class="st">"DP"</span>, as.numeric<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/heatmap_bp.html" class="external-link">heatmap.bp</a></span><span class="op">(</span><span class="va">dp</span>, rlabels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="100%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#plot genotype quality per snp and per sample</span></span>
<span><span class="va">gq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/extract_gt.html" class="external-link">extract.gt</a></span><span class="op">(</span><span class="va">vcfR</span>, element <span class="op">=</span> <span class="st">"GQ"</span>, as.numeric<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/heatmap_bp.html" class="external-link">heatmap.bp</a></span><span class="op">(</span><span class="va">gq</span>, rlabels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-2.png" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="step-6">Step 6:<a class="anchor" aria-label="anchor" href="#step-6"></a>
</h3>
<div class="section level4">
<h4 id="write-out-vcf-files-for-downstream-analyses">Write out vcf files for downstream analyses.<a class="anchor" aria-label="anchor" href="#write-out-vcf-files-for-downstream-analyses"></a>
</h4>
</div>
<div class="section level4">
<h4 id="optionally-we-can-use-the-distance_thin-function-from-the-snpfiltr-package-in-order-to-filter-our-snps-to-a-minimum-distance-between-snps-in-order-to-get-a-set-of-unlinked-snps-for-downsteam-analyses">Optionally, we can use the distance_thin() function from the SNPfiltR package in order to filter our SNPs to a minimum distance between SNPs, in order to get a set of unlinked SNPs for downsteam analyses<a class="anchor" aria-label="anchor" href="#optionally-we-can-use-the-distance_thin-function-from-the-snpfiltr-package-in-order-to-filter-our-snps-to-a-minimum-distance-between-snps-in-order-to-get-a-set-of-unlinked-snps-for-downsteam-analyses"></a>
</h4>
</div>
<div class="section level4">
<h4 id="note-5">Note:<a class="anchor" aria-label="anchor" href="#note-5"></a>
</h4>
<p>The function vcfR::write.vcf() automatically writes a gzipped vcf file, so be sure to add the suffix .gz to the name of your output file.</p>
</div>
<div class="section level4">
<h4 id="write-out-the-filtered-vcf-and-a-linkage-filtered-version-for-downstream-analyses">Write out the filtered vcf, and a linkage filtered version, for downstream analyses<a class="anchor" aria-label="anchor" href="#write-out-the-filtered-vcf-and-a-linkage-filtered-version-for-downstream-analyses"></a>
</h4>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#write out vcf with all SNPs</span></span>
<span><span class="fu">vcfR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vcfR/man/io_vcfR.html" class="external-link">write.vcf</a></span><span class="op">(</span><span class="va">vcfR</span>, <span class="st">"~/Downloads/aphelocoma.filtered.vcf.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#linkage filter vcf to thin SNPs to one per 500bp</span></span>
<span><span class="va">vcfR.thin</span><span class="op">&lt;-</span><span class="fu"><a href="reference/distance_thin.html">distance_thin</a></span><span class="op">(</span><span class="va">vcfR</span>, min.distance <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1 duplicated SNPs removed from input vcf</span></span>
<span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |==                                                                    |   3%  |                                                                              |====                                                                  |   6%  |                                                                              |======                                                                |   9%  |                                                                              |========                                                              |  12%  |                                                                              |==========                                                            |  15%  |                                                                              |============                                                          |  18%  |                                                                              |==============                                                        |  21%  |                                                                              |================                                                      |  24%  |                                                                              |===================                                                   |  26%  |                                                                              |=====================                                                 |  29%  |                                                                              |=======================                                               |  32%  |                                                                              |=========================                                             |  35%  |                                                                              |===========================                                           |  38%  |                                                                              |=============================                                         |  41%  |                                                                              |===============================                                       |  44%  |                                                                              |=================================                                     |  47%  |                                                                              |===================================                                   |  50%  |                                                                              |=====================================                                 |  53%  |                                                                              |=======================================                               |  56%  |                                                                              |=========================================                             |  59%  |                                                                              |===========================================                           |  62%  |                                                                              |=============================================                         |  65%  |                                                                              |===============================================                       |  68%  |                                                                              |=================================================                     |  71%  |                                                                              |===================================================                   |  74%  |                                                                              |======================================================                |  76%  |                                                                              |========================================================              |  79%  |                                                                              |==========================================================            |  82%  |                                                                              |============================================================          |  85%  |                                                                              |==============================================================        |  88%  |                                                                              |================================================================      |  91%  |                                                                              |==================================================================    |  94%  |                                                                              |====================================================================  |  97%  |                                                                              |======================================================================| 100%</span></span>
<span><span class="co">#&gt; 2550 out of 7554 input SNPs were not located within 500 base-pairs of another SNP and were retained despite filtering</span></span>
<span></span>
<span><span class="co">#write out thinned vcf</span></span>
<span><span class="co">#vcfR::write.vcf(vcfR.thin, "~/Downloads/aphelocoma.filtered.thinned.vcf.gz")</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=SNPfiltR" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SNPfiltR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Devon DeRaad <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3105-985X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://zenodo.org/badge/latestdoi/397722868" class="external-link"><img src="https://zenodo.org/badge/397722868.svg" alt="DOI"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Devon DeRaad.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
